<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>OKR Summarizer</title>
		<meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
        <link rel="stylesheet" href="index.css">
	</head>
	<body>

        {% macro labelMacro(data) -%}
            <span class="label" style="background-color: #{{ data.color }}">{{ data.name }}</span>
        {%- endmacro %}

        <div class="container">
            <h2>OKR Management Summaries</h2>
            <p><a href="index.html">Back to home page</a></p>
            {% for project_id, project_data in projects_data.items() %}
                <h3><a id="project-{{ project_data.project.id }}"></a>{{ project_data.project.name }}</h3>
                <p>
                    <a href="{{ project_data.project.html_url }}" class="github">OKRs on GitHub</a> 
                    &bull; <a href="#project-{{ project_data.project.id }}">anchor</a>
                </p>

                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Title</th>
                            <th>Timeline</th>
                    </tr>
                    </thead>
                <tbody>
                    {% for card_title, card_url in project_data.contents_order %}
                        <tr class="okr-row">
                        {% set content = project_data.contents[card_url] %}
                            <td>
                                <b>
                                    <a id="content-{{ content.id }}" href="{{ content.html_url }}" class="github">{{ content.title }}</a>
                                </b>
                                <p>
                                    <a href="{{ content.assignee.html_url }}" class="github">
                                    <img src="{{ content.assignee.avatar_url }}" class="avatar">
                                    {{ content.assignee.login }}</a>
                                    &bull; <a href="#content-{{ content.id }}">anchor</a>
                                </p>
                                <p>{{ content.body }}</p>
                            </td>
                            <td>
                                {% set timeline_changes = project_data.timeline_changes[content['timeline_url']] %}
                                <table>
                                    <tr>
                                        <th>Current status</th>
                                        <td>{% for label in content.labels %}
                                                {{ labelMacro(label)}}
                                            {% endfor %}
                                        </td>
                                    </tr>
                                    {% for line in timeline_changes %}
                                        <tr>
                                            {% if line.event == 'labeled' %}
                                                <td><a href="{{ line.html_url }}" class="github">Label added</a></a> 
                                                    (<span class="date" title="{{ line.created_at.strftime('%Y-%m-%d') }}">{{ line.created_at.strftime('%Y-%m-%d') }}</span>)</td>
                                                <td>{{ labelMacro(line.label)}}</td>
                                            {% endif %}
                                            {% if line.event == 'commented' %}
                                                <td><a href="{{ line.html_url }}" class="github">Commented</a>
                                                    (<span class="date" title="{{ line.created_at.strftime('%Y-%m-%d') }}">{{ line.created_at.strftime('%Y-%m-%d') }}</span>)</td>
                                                <td>{{ line.body }}</td>
                                            {% endif %}
                                        </tr>
                                        {% endfor %}
                                </table>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>    
                </table>

            {% endfor %}
        </div>
        <script src="moment.min.js"></script>
        <script style="text/javascript">
            function update() {
              for (let zone of document.getElementsByClassName(["date"])) {
                zone.innerText = moment(zone.innerText, "YYYY-MM-DD").fromNow()
              }
            };
            update();
          </script>
      
    </body>
</html>